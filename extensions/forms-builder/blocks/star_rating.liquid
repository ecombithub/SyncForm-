<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.min.css">

<div class="form_builder_app {{ block.id }}" id="formBuilderApp-{{ block.id }}">
  <form
    id="formData-{{ block.id }}"
    style="background-size: cover;"
    onsubmit="
       submitFormData(event, '{{ block.id }}', 'formID',
      'formTitle', 'formshop', 'shopNameHeading',
      'toggleStatus', 'editorValue', 'submissionOption', 'thankYouTimer', 'formUrl', 'emailsubject', 'shopNameEmail','onwerShopData','nofieldValue', this)
    "
  ></form>
</div>
<style>
  .input-field.input-gap {
    width: 100%;
  }

  .iti.iti--allow-dropdown input {
    height: 52px !important;
  }

  .slider-value {
    position: absolute;
    bottom: 4px;
    left: 15px;
    transform: translateX(-50%);
    background-color: #23c66d;
    color: white;
    padding: 0px 5px;
    border-radius: 1px;
    font-size: 11px;
    font-weight: bold;
  }

  .custom-select-container .custom-select-option {
    color: gray;
    text-align: left;
  }

  .email-files.drop.files h2 {
    margin: 0;
  }
  .form_builder_app .iti__arrow {
    display: block !important;
  }

  .form_builder_app input {
    outline: none !important;
    box-shadow: none !important;
  }

  .form_builder_app textarea {
    outline: none !important;
    box-shadow: none !important;
  }
  .form_builder_app input {
    font-size: 15px !important;
  }

  .form_builder_app select {
    font-size: 15px !important;
  }

  .form_builder_app textarea {
    font-size: 15px !important;
  }
  img.form-builder-wred-starr-requid {
    width: 7px;
    top: 3px;
    height: 7px;
    margin-left: 5px;
  }

  .form_radio_flex input {
    width: 20px;
    height: 20px;
    margin: 0;
  }
  .form_checkbox_flex input {
    margin: 0;
    width: 20px;
    height: 20px;
  }

  img.form-builder-wred-starr-requid.toggle {
    position: absolute;
  }

  .input-field.input-gap label {
    display: flex;
  }
  .input-field.input-gap .iti__flag-container {
    border: 1px solid grey;
    border-radius: 5px;
    width: 44px;
  }

  .form_builder_app .iti__flag {
    display: block !important;
  }

  .form_builder_app ul {
    padding: 0;
  }
  .brand-logos {
    display: flex;
    width: 100%;
    justify-content: right;
    padding-top: 20px;
  }

  .select-error-message {
    border: 1px solid #cad2ca;
    width: 100%;
    max-width: 25%;
    padding: 10px;
    text-align: center;
    border-radius: 4px;
    position: absolute;
    left: 38%;
    bottom: -29px;
    font-size: 14px;
    display: flex;
    align-items: center;
    gap: 10px;
    justify-content: center;
    color: black;
    background:white;
    box-shadow: -5px -5px 10px 0px rgba(255, 255, 255, 0.5), 5px 5px 10px 0px rgba(0, 0, 0, 0.3);
  }

  .select-error-message img {
    width: 23px;
}

  .error-icon {
    width: 19px!important;
    height: 11px!important;
    position: absolute;
    top: -11px;
    left: 40px;
}


  @media screen and (max-width: 640px) {
    .small-width {
      width: 50% !important;
    }
  }

  @media screen and (max-width: 540px) {
    .form_builder_app .form-builder-changes-file-wraped .email-files.drop {
      width: 50% !important;
      margin: auto;
    }
    .form-builder-chaneging-wrap.file .email-files.drop.files {
      width: 100% !important;
    }

    .form-builder-chaneging-wrap.file .email-files.drop.files p {
      max-width: 80% !important;
      margin-bottom: 20px !important;
    }
    .form-builder-chaneging-wrap.file .email-files.drop.files span {
      padding: 10px 12px !important;
    }

    .drag-and-drop-text.first.multi-imagess h3 {
      margin-bottom: 20px !important;
      font-size: 16px !important;
      line-height: 20px !important;
    }
  }

  @media screen and (max-width: 540px) {
    .small-width {
      width: 100% !important;
    }
  }
</style>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    var appEmbedBlock = document.querySelector('[data-block-handle="floating_image"]');
    var formBlocks = document.querySelectorAll('[id^="formBuilderApp-"]');

    formBlocks.forEach(function (formBlock) {
      if (appEmbedBlock) {
        formBlock.style.display = 'block';
      } else {
        formBlock.style.display = 'none';
      }
    });
  });

  function toggleDropdown(event, fieldId) {
    event.stopPropagation();
    const dropdown = document.getElementById(`dropdown-${fieldId}`);
    const selectBox = dropdown.previousElementSibling;
    const arrowSpan = selectBox.querySelector('span:last-child');

    const isVisible = dropdown.style.display === 'block';
    document.querySelectorAll('.custom-select-dropdown').forEach((d) => (d.style.display = 'none'));
    dropdown.style.display = isVisible ? 'none' : 'block';

    arrowSpan.innerHTML = isVisible
      ? '<img src="https://cdn.shopify.com/s/files/1/0682/5974/1942/files/imgpsh_fullsize_anim_52.png?v=1741756373" style="width:15px;">'
      : '<img src="https://cdn.shopify.com/s/files/1/0682/5974/1942/files/5yhh.png?v=1741756624" style="width:15px;">';
  }

  document.addEventListener('click', function (event) {
    document.querySelectorAll('.custom-select-container').forEach((container) => {
      if (!container.contains(event.target)) {
        const dropdown = container.querySelector('.custom-select-dropdown');
        if (dropdown) {
          dropdown.style.display = 'none';
          const selectBox = container.querySelector('.custom-select-box span:last-child');
          selectBox.innerHTML =
            '<img src="https://cdn.shopify.com/s/files/1/0682/5974/1942/files/imgpsh_fullsize_anim_52.png?v=1741756373" style="width:15px;">';
        }
      }
    });
  });

  function filterOptions(event, fieldId) {
    const searchInput = event.target.value.toLowerCase();
    const optionsContainer = document.querySelector(`#dropdown-${fieldId} .options-container`);
    const options = optionsContainer.querySelectorAll('.custom-select-option');

    options.forEach((option) => {
      const text = option.textContent.toLowerCase();
      option.style.display = text.includes(searchInput) ? 'block' : 'none';
    });
  }

  document.addEventListener('click', function (event) {
    if (event.target.classList.contains('custom-select-option')) {
      const selectedValue = event.target.getAttribute('data-value');
      const selectedLabel = event.target.textContent;

      const selectBox = event.target
        .closest('.custom-select-container')
        .querySelector('.custom-select-box span:first-child');
      selectBox.textContent = selectedLabel;

      const dropdown = event.target.closest('.custom-select-dropdown');
      dropdown.style.display = 'none';

      const arrowSpan = selectBox.nextElementSibling;
      arrowSpan.innerHTML =
        '<img src="https://cdn.shopify.com/s/files/1/0682/5974/1942/files/imgpsh_fullsize_anim_52.png?v=1741756373" style="width:15px;">';
    }
  });

  var handleClickImages = (fileInputId) => {
    const fileInput = document.getElementById(fileInputId);
    fileInput.click();
  };

  function handleDragOverimages(event) {
    event.preventDefault();
    event.stopPropagation();
  }

  function handleSingleInputChange(event, fieldId, fieldLabel, fieldImagePreview, fieldsignlePreview) {
    const files = event.target.files;

    const maxSize = 50 * 1024 * 1024;
    const warningElement = document.getElementById(`max-file-size-${fieldId}`);

    const validFiles = Array.from(files).filter((file) => {
      if (file.size > maxSize) {
        console.error(`File "${file.name}" exceeds the 50MB limit.`);

        if (warningElement) {
          warningElement.style.display = 'block';

          setTimeout(() => {
            warningElement.style.display = 'none';
          }, 5000);
        }

        return false;
      }
      return true;
    });

    if (validFiles.length > 0) {
      displayimagesNames(validFiles, fieldId, fieldLabel, fieldImagePreview, fieldsignlePreview);
    }
  }

  function handleDropimages(event, fieldId, fieldLabel, fieldImagePreview, fieldsignlePreview) {
    event.preventDefault();
    event.stopPropagation();

    const fileInput = document.getElementById(`file-input-${fieldId}`);

    const files = event.dataTransfer.files;
    const maxSize = 50 * 1024 * 1024;
    const warningElement = document.getElementById(`max-file-size-${fieldId}`);

    const validFiles = Array.from(files).filter((file) => {
      if (file.size > maxSize) {
        console.error(`File "${file.name}" exceeds the 50MB limit.`);

        if (warningElement) {
          warningElement.style.display = 'block';

          setTimeout(() => {
            warningElement.style.display = 'none';
          }, 5000);
        }

        return false;
      }
      return true;
    });

    if (validFiles.length > 0) {
      displayimagesNames(validFiles, fieldId, fieldLabel, fieldImagePreview, fieldsignlePreview);
    }
  }

  var uploadeImages = {};

  function displayimagesNames(files, fieldId, fieldLabel, fieldImagePreview, fieldsignlePreview) {
    let fileNamesList = document.getElementById(`file-names-list-${fieldId}`);

    if (!fileNamesList) {
      const formBuilderContainer = document
        .querySelector(`#file-input-${fieldId}`)
        .closest('.form-builder-chaneging-wrap');

      if (formBuilderContainer) {
        const ul = document.createElement('ul');
        ul.id = `file-names-list-${fieldId}`;
        formBuilderContainer.appendChild(ul);
        fileNamesList = ul;
      }
    }

    fileNamesList.innerHTML = '';

    if (!uploadeImages[fieldId]) {
      uploadeImages[fieldId] = [];
    }

    Array.from(files).forEach((file) => {
      if (uploadeImages[fieldId].some((existingFile) => existingFile.name === file.name)) {
        console.warn(`File "${file.name}" already added. Skipping.`);
        return;
      }

      const li = document.createElement('li');
      li.style.border = '1px solid #ddd';
      li.style.padding = '8px';
      li.style.marginBottom = '5px';
      li.style.display = 'flex';
      li.style.justifyContent = 'space-between';
      li.style.alignItems = 'center';
      li.style.gap = '20px';

      const fileName = document.createElement('span');
      fileName.textContent = file.name;
      fileName.style.flex = '1';

      const removeButton = document.createElement('button');
      removeButton.style.padding = '0';
      removeButton.style.border = 'none';
      removeButton.style.background = 'none';

      const reader = new FileReader();
      reader.onload = function (e) {
        const imagePreview = document.createElement('img');
        imagePreview.style.width = '40px';
        imagePreview.style.maxHeight = '40px';
        imagePreview.src = e.target.result;

        uploadeImages[fieldId].push({
          name: file.name,
          base64: e.target.result,
          label: fieldLabel,
        });

        const removeImage = document.createElement('img');
        removeImage.src = 'https://cdn.shopify.com/s/files/1/0780/6255/1355/files/cancle1_1.png?v=1738132508';
        removeImage.alt = 'Remove';
        removeImage.style.width = '20px';
        removeImage.style.height = '20px';
        removeImage.style.cursor = 'pointer';

        removeImage.onclick = () => {
          uploadeImages[fieldId] = uploadeImages[fieldId].filter((uploadedFile) => uploadedFile.name !== file.name);
          li.remove();
          console.log(`Removed file: ${file.name}`);
        };

        li.appendChild(fileName);
        if (fieldImagePreview === 'on' || fieldsignlePreview === 'on') {
          li.appendChild(imagePreview);
        }

        li.appendChild(removeImage);
        fileNamesList.appendChild(li);
      };

      reader.readAsDataURL(file);
    });
  }

  function handleClickmulti(fileInputId) {
    const fileInput = document.getElementById(fileInputId);
    fileInput.click();
  }

  function handleDragOverfile(event) {
    event.preventDefault();
    event.stopPropagation();
  }

  var droppedMulti = [];

  function handleMultiInputChange(event, fieldId, fieldLabel, fieldmultifilePreview) {
    const fileInput = event.target;
    let files = Array.from(fileInput.files);
    const maxFiles = 10;
    const maxSize = 25 * 1024 * 1024;

    const warningElement = document.getElementById(`max-file-size-${fieldId}`);
    const maxFileAddElement = document.getElementById(`max-file-add-${fieldId}`);

    if (files.length > maxFiles) {
      if (maxFileAddElement) {
        maxFileAddElement.style.display = 'block';
        setTimeout(() => (maxFileAddElement.style.display = 'none'), 5000);
      }
      fileInput.value = '';
      return;
    }

    const validFiles = files.filter((file) => {
      if (file.size > maxSize) {
        console.error(`File "${file.name}" exceeds the 25MB limit.`);
        if (warningElement) {
          warningElement.style.display = 'block';
          setTimeout(() => (warningElement.style.display = 'none'), 5000);
        }
        return false;
      }
      return true;
    });

    if (validFiles.length === 0) {
      fileInput.value = '';
      return;
    }

    displayFileNames(validFiles, fieldId, fieldLabel, fieldmultifilePreview);
  }

  function handleDropfile(event, fieldId, fieldLabel, fieldmultifilePreview) {
    event.preventDefault();
    event.stopPropagation();

    const fileInput = document.getElementById(`file-input-${fieldId}`);
    if (!fileInput) return;

    if (!event.dataTransfer || !event.dataTransfer.files) return;

    const files = event.dataTransfer.files;
    const maxFiles = 10;
    const maxSize = 25 * 1024 * 1024;

    const warningElement = document.getElementById(`max-file-size-${fieldId}`);
    const maxFileAddElement = document.getElementById(`max-file-add-${fieldId}`);

    if (files.length > maxFiles) {
      if (maxFileAddElement) {
        maxFileAddElement.style.display = 'block';
        setTimeout(() => {
          maxFileAddElement.style.display = 'none';
        }, 5000);
      }
      return;
    }

    const validFiles = Array.from(files).filter((file) => {
      if (file.size > maxSize) {
        if (warningElement) {
          warningElement.style.display = 'block';
          setTimeout(() => {
            warningElement.style.display = 'none';
          }, 5000);
        }
        return false;
      }
      return true;
    });

    if (validFiles.length > 0) {
      displayFileNames(validFiles, fieldId, fieldLabel, fieldmultifilePreview);
    }
  }

  var uploadedmulti = {};

  function displayFileNames(files, fieldId, fieldLabel, fieldmultifilePreview) {
    const fileNamesList = document.getElementById(`file-names-list-${fieldId}`);

    if (!fileNamesList) {
      const formBuilderContainer = document
        .querySelector(`#file-input-${fieldId}`)
        .closest('.form-builder-chaneging-wrap');
      if (formBuilderContainer) {
        const ul = document.createElement('ul');
        ul.id = `file-names-list-${fieldId}`;
        formBuilderContainer.appendChild(ul);
        fileNamesList = ul;
      }
    }

    fileNamesList.innerHTML = '';

    if (!uploadedmulti[fieldId]) {
      uploadedmulti[fieldId] = [];
    }

    Array.from(files).forEach((file) => {
      const li = document.createElement('li');
      li.style.border = '1px solid #ddd';
      li.style.padding = '8px';
      li.style.marginBottom = '5px';
      li.style.display = 'flex';
      li.style.justifyContent = 'space-between';
      li.style.alignItems = 'center';
      li.style.gap = '20px';

      const fileName = document.createElement('span');
      fileName.textContent = file.name;
      fileName.style.flex = '1';

      const removeButton = document.createElement('button');
      removeButton.style.padding = '0';
      removeButton.style.border = 'none';
      removeButton.style.background = 'none';

      const removeImage = document.createElement('img');
      removeImage.src = 'https://cdn.shopify.com/s/files/1/0780/6255/1355/files/cancle1_1.png?v=1738132508';
      removeImage.alt = 'Remove';
      removeImage.style.width = '20px';
      removeImage.style.height = '20px';
      removeImage.style.cursor = 'pointer';

      removeButton.appendChild(removeImage);

      const reader = new FileReader();
      reader.onload = function (e) {
        const imagePreview = document.createElement('img');
        imagePreview.style.maxWidth = '40px';
        imagePreview.style.maxHeight = '40px';
        // imagePreview.src = e.target.result; // Uncomment this if you want to show the image preview

        uploadedmulti[fieldId].push({
          name: file.name,
          base64: e.target.result,
          Label: fieldLabel,
        });

        removeButton.onclick = () => {
          removeFil1e(file.name, fieldId, fileNamesList, li);
        };

        li.appendChild(fileName);
        if (fieldmultifilePreview === 'on') {
          imagePreview.src = e.target.result;
          li.appendChild(imagePreview);
        }
        li.appendChild(removeButton);
        fileNamesList.appendChild(li);
      };

      reader.readAsDataURL(file);
    });
  }

  function removeFil1e(fileName, fieldId, fileNamesList, li) {
    if (!uploadedmulti[fieldId]) {
      console.log(`No files found for fieldId: ${fieldId}`);
      return;
    }

    uploadedmulti[fieldId] = uploadedmulti[fieldId].filter((file) => file.name !== fileName);

    fileNamesList.removeChild(li);
  }

  function handleDragOver(event) {
    event.preventDefault();
    event.stopPropagation();
  }

  var droppedFiles = [];

  function handleFileInputChange(event, fieldId, fieldLabel, fieldmultiIamgePreview) {
    const fileInput = event.target;
    let files = Array.from(fileInput.files);
    const maxFiles = 10;
    const maxSize = 25 * 1024 * 1024;

    const warningElement = document.getElementById(`max-file-size-${fieldId}`);
    const maxFileAddElement = document.getElementById(`max-file-add-${fieldId}`);

    if (files.length > maxFiles) {
      if (maxFileAddElement) {
        maxFileAddElement.style.display = 'block';
        setTimeout(() => (maxFileAddElement.style.display = 'none'), 5000);
      }
      fileInput.value = '';
      return;
    }

    const validFiles = files.filter((file) => {
      if (file.size > maxSize) {
        console.error(`File "${file.name}" exceeds the 25MB limit.`);
        if (warningElement) {
          warningElement.style.display = 'block';
          setTimeout(() => (warningElement.style.display = 'none'), 5000);
        }
        return false;
      }
      return true;
    });

    if (validFiles.length === 0) {
      fileInput.value = '';
      return;
    }

    displayImage(validFiles, fieldId, fieldLabel, fieldmultiIamgePreview);
  }

  function handleDrop(event, fieldId, fieldLabel, fieldmultiIamgePreview) {
    event.preventDefault();
    event.stopPropagation();

    const fileInput = document.getElementById(`file-input-${fieldId}`);

    if (!fileInput) {
      return;
    }

    const files = event.dataTransfer.files;

    const maxFiles = 10;
    const maxSize = 25 * 1024 * 1024;
    const warningElement = document.getElementById(`max-file-size-${fieldId}`);
    const maxFileAddElement = document.getElementById(`max-file-add-${fieldId}`);

    if (files.length > maxFiles) {
      if (maxFileAddElement) {
        maxFileAddElement.style.display = 'block';

        setTimeout(() => {
          maxFileAddElement.style.display = 'none';
        }, 5000);
      }
      return;
    }

    const validFiles = Array.from(files).filter((file) => {
      if (file.size > maxSize) {
        console.error(`File "${file.name}" exceeds the 50MB limit.`);

        if (warningElement) {
          warningElement.style.display = 'block';

          setTimeout(() => {
            warningElement.style.display = 'none';
          }, 5000);
        }

        return false;
      }
      return true;
    });

    if (validFiles.length > 0) {
      displayImage(files, fieldId, fieldLabel, fieldmultiIamgePreview);
    }
  }

  function handleDrop(event, fieldId, fieldLabel, fieldmultiIamgePreview) {
    event.preventDefault();
    event.stopPropagation();

    const fileInput = document.getElementById(`file-input-${fieldId}`);

    if (!fileInput) {
      console.error('File input not found for fieldId:', fieldId);
      return;
    }

    const files = event.dataTransfer.files;
    const maxFiles = 10;
    const maxSize = 25 * 1024 * 1024;
    const warningElement = document.getElementById(`max-file-size-${fieldId}`);
    const maxFileAddElement = document.getElementById(`max-file-add-${fieldId}`);

    if (files.length > maxFiles) {
      if (maxFileAddElement) {
        maxFileAddElement.style.display = 'block';

        setTimeout(() => {
          maxFileAddElement.style.display = 'none';
        }, 5000);
      }
      return;
    }

    const validFiles = Array.from(files).filter((file) => {
      if (file.size > maxSize) {
        console.error(`File "${file.name}" exceeds the 50MB limit.`);

        if (warningElement) {
          warningElement.style.display = 'block';

          setTimeout(() => {
            warningElement.style.display = 'none';
          }, 5000);
        }

        return false;
      }
      return true;
    });

    if (validFiles.length > 0) {
      displayImage(files, fieldId, fieldLabel, fieldmultiIamgePreview);
    }
  }

  var uploadedFiles = {};

  function displayImage(files, fieldId, fieldLabel, fieldmultiIamgePreview) {
    const fileNamesList = document.getElementById(`image-names-list-${fieldId}`);

    if (!fileNamesList) {
      return;
    }

    fileNamesList.innerHTML = '';

    if (!uploadedFiles[fieldId]) {
      uploadedFiles[fieldId] = [];
    }

    Array.from(files).forEach((file) => {
      const li = document.createElement('li');
      li.style.border = '1px solid #ddd';
      li.style.padding = '8px';
      li.style.marginBottom = '5px';
      li.style.display = 'flex';
      li.style.justifyContent = 'space-between';
      li.style.alignItems = 'center';
      li.style.gap = '20px';

      const fileName = document.createElement('span');
      fileName.textContent = file.name;
      fileName.style.flex = '1';

      const actionContainer = document.createElement('div');
      actionContainer.style.display = 'flex';
      actionContainer.style.alignItems = 'center';
      actionContainer.style.gap = '20px';

      const removeButton = document.createElement('button');
      removeButton.style.padding = '0';
      removeButton.style.border = 'none';
      removeButton.style.background = 'none';

      const removeImage = document.createElement('img');
      removeImage.src = 'https://cdn.shopify.com/s/files/1/0780/6255/1355/files/cancle1_1.png?v=1738132508';
      removeImage.alt = 'Remove';
      removeImage.style.width = '20px';
      removeImage.style.height = '20px';
      removeImage.style.cursor = 'pointer';

      removeButton.appendChild(removeImage);

      const reader = new FileReader();

      reader.onload = function (e) {
        uploadedFiles[fieldId].push({
          name: file.name,
          base64: e.target.result,
          Label: fieldLabel,
        });

        removeButton.onclick = () => removeFile(file.name, fieldId, fileNamesList, li);

        if (fieldmultiIamgePreview === 'on') {
          const imagePreview = document.createElement('img');
          imagePreview.style.width = '40px';
          imagePreview.style.height = '40px';
          imagePreview.src = e.target.result;

          actionContainer.appendChild(imagePreview);
        }

        actionContainer.appendChild(removeButton);
        li.appendChild(fileName);
        li.appendChild(actionContainer);
        fileNamesList.appendChild(li);
      };

      reader.onerror = function (error) {};

      reader.readAsDataURL(file);
    });
  }

  function removeFile(fileName, fieldId, fileNamesList, li) {
    if (!uploadedFiles[fieldId]) return;
    uploadedFiles[fieldId] = uploadedFiles[fieldId].filter((file) => file.name !== fileName);
    fileNamesList.removeChild(li);
  }

  $(document).ready(function () {
    const formId = '{{ block.settings.formId }}';

    if (formId && formId !== 'default-id') {
      fetchFormData(formId);
    }

    function fetchFormData(id) {
      $('#formData-{{ block.id }}').empty();

      $.ajax({
        url: `https://apps.syncform.app/get-form/${id}`,
        method: 'GET',
        success: function (data) {
          if (data.status === 'draft') {
            $('#formData-{{ block.id }}').append('');
            return;
          }

          displayFormData(data);
          console.log(data);
        },
        error: function (jqXHR, textStatus, errorThrown) {
          $('#formData-{{ block.id }}').append('<p></p>');
        },
      });
    }

    function displayFormData(formData) {
      const container = $('#formData-{{ block.id }}');
      const formTitle = formData.title || 'Form Data';
      const formID = formData.formId || 'Unknown ID';
      const formshop = formData.shop || 'Form shop';
      const toggleStatus = formData.toggleStatus || 'toggleStatus';
      const shopNameHeading = formData.styles.shopName || '';
      const editorValue = formData.editorValue;
      const submissionOption = formData.submissionOption;
      const thankYouTimer = formData.thankYouTimer;
      const formUrl = formData.url;
      const emailsubject = formData.styles.subject;
      const shopNameEmail = formData.styles.shopEmail || '';
      const onwerShopData = formData.styles.onwerShop || '';
      const nofieldValue = 'Your form is empty. Please fill in the details before submitting.';


      container.empty();
      $('#formData-{{ block.id }}').attr(
        'onsubmit',
        `submitFormData(event, '{{ block.id }}', '${formID}',
         '${formTitle}', '${formshop}', '${shopNameHeading}', '${toggleStatus}', '${editorValue}', 
         '${submissionOption}', '${thankYouTimer}','${formUrl}','${emailsubject}','${shopNameEmail}','${onwerShopData}', '${nofieldValue}',this)`
      );

      async function getBrandLogo(formshop) {
        try {
          const response = await fetch(`https://apps.syncform.app/data/brandLogo/${formshop}`);
          if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
          }

          const BrandLogo = await response.json();
          if (BrandLogo.status === 'active') {
            container.append(`
              <div class="brand-logos">
              <img src="https://cdn.shopify.com/s/files/1/0682/5974/1942/files/brandlogos.png?v=1741174088">
              </div>
            `);
          }
        } catch (error) {
          console.error('Error fetching brand logo:', error);
        }
      }

      getBrandLogo(formshop);

      if (formData.styles) {
        const backgroundOverlay = $(
          '<div class="background-overlay"><span style="display: none;">background-overlay</span></div>'
        );
        backgroundOverlay.css({
          position: 'absolute',
          top: 0,
          left: 0,
          right: 0,
          bottom: 0,
          backgroundSize: 'cover',
          backgroundPosition: 'center',
          backgroundColor: formData.styles.backgroundColor || '',
          backgroundImage: formData.styles.backgroundImage ? `url(${formData.styles.backgroundImage})` : 'none',
          backgroundRepeat: formData.styles.backgroundRepeat || 'no-repeat',
          opacity: formData.styles.opacityForm || 1,
          borderColor: formData.styles.borderColor || '',
          borderWidth: formData.styles.borderWidth || '',
          borderStyle: formData.styles.borderStyle || '',
          boxShadow: formData.styles.boxShadow || '',
          borderRadius: formData.styles.borderRadius ? `${formData.styles.borderRadius}px` : '',
          zIndex: -1,
        });

        container.append(backgroundOverlay);

        container.css({
          position: 'relative',
          width: '100%',
          maxWidth: formData.styles.width || '100%',
          padding: formData.styles.padding || '',
          margin: 'auto',
          marginTop: `${formData.styles.marginForm}px`,
          marginBottom: `${formData.styles.marginForm}px`,
        });
      }

      container.append(`<h2 style="display:none">${formshop}</h2>`);
      container.append(`<h2 style="display:none">${formTitle}</h2>`);
      container.append(`<h2 style="display:none">${toggleStatus}</h2>`);
      container.append(`<p style="display:none"><strong>Form ID:</strong> ${formID}</p>`);

      if (formData.fields && formData.fields.length > 0) {
        formData.fields.forEach((field) => {
          const floatStyle =
            (field.type === 'text' ||
              field.type === 'name' ||
              field.type === 'email' ||
              field.type === 'slider' ||
              field.type === 'number' ||
              field.type === 'file' ||
              field.type === 'phone' ||
              field.type === 'tel' ||
              field.type === 'datetime' ||
              field.type === 'location' ||
              field.type === 'multi-file' ||
              field.type === 'multi-image' ||
              field.type === 'password' ||
              field.type === 'images' ||
              field.type === 'select' ||
              field.type === 'radio' ||
              field.type === 'checkbox' ||
              field.type === 'textarea' ||
              field.type === 'date' ||
              field.type === 'time' ||
              field.type === 'url') &&
            (parseFloat(field.width) <= 50 ||
              parseFloat(field.width) === 25 ||
              parseFloat(field.width) === 50 ||
              parseFloat(field.width) === 75)
              ? 'float: inline-start;'
              : '';
          const inputGap = formData.styles.inputGap || '0px';
          const labelColor = formData.styles.labelColor || '#000';
          const inputRadius = formData.styles.inputRadious;
          const inputBorderColor = formData.styles.inputborderColor;
          const inputBgColor = formData.styles.inputBgColor;
          const inputStyle = formData.styles.inputstyle;
          const inputWidth = formData.styles.inputwidth;

          const maxDescriptionHeight = formData.styles.maxDescriptionHeight;

          const screenWidth = window.innerWidth;
          const smallScreenClass = screenWidth < 640 ? 'small-screen' : '';

          const fieldHtml = `
                  <div key="${field.id}" style= "width: ${
            field.width
          }; ${floatStyle} margin-bottom: ${inputGap}px;"class="${`input-field ${field.customClass} input-gap ${
            parseFloat(field.width) <= 50 ? 'small-width' : ''
          } ${smallScreenClass}`}">
                      ${
                        field.type !== 'heading' &&
                        field.type !== 'description' &&
                        field.type !== 'button' &&
                        field.type !== 'link' &&
                        field.type !== 'divider'
                          ? `<label style="color: ${labelColor};">${field.label}
                          ${
                            field.required
                              ? `<img class="form-builder-wred-starr-requid" 
                          src="https://cdn.shopify.com/s/files/1/0780/6255/1355/files/imgpsh_fullsize_anim_28.png?v=1740472426" 
                           alt="Required Field" />`
                              : ''
                          }
                          ${
                            field.emailRequid
                              ? `<img class="form-builder-wred-starr-requid" 
                          src="https://cdn.shopify.com/s/files/1/0780/6255/1355/files/imgpsh_fullsize_anim_28.png?v=1740472426" 
                           alt="Required Field" />`
                              : ''
                          }
                           </label>`
                          : ''
                      }
                      
                     ${getFieldInput(
                       field,
                       formData.url,
                       formData.submissionOption,
                       formData.thankYouTimer,
                       formData.editorValue,
                       formshop,
                       formTitle,
                       toggleStatus,
                       inputRadius,
                       inputBorderColor,
                       inputBgColor,
                       inputStyle,
                       inputWidth,
                       emailsubject,
                       labelColor,
                       maxDescriptionHeight,
                       shopNameHeading
                     )}
                  </div>
                  `;
          container.append(fieldHtml);
        });

        $('.input-gap').css({
          padding: '5px',
          display: 'flow-root',
        });

        $('.iti').css('width', '100%');
      } else {
        container.append('<p>No fields available.</p>');
      }
      container.append('<div class="clear-float"></div>');
    }

    window.validatePassword = function (input) {
      const passwordStatus = input.dataset.passwordStatus;
      const passwordCharacter = input.dataset.passwordCharacter;
      const password = input.value;
      const errorMessage = input.nextElementSibling.nextElementSibling;

      const minLength = parseInt(passwordCharacter, 10) || 6;
      let isValid = password.length >= minLength;
      let errorText = `Password must be at least ${minLength} characters long.`;

      if (passwordStatus === 'on') {
        const hasNumber = /\d/.test(password);
        const hasSpecialChar = /[!@#$%^&*(),.?":{}|<>]/.test(password);

        if (!hasNumber || !hasSpecialChar) {
          isValid = false;
          errorText = `Password must be at least ${minLength} characters long, include at least one number, and one special character.`;
        }
      }

      if (!isValid) {
        errorMessage.textContent = errorText;
        errorMessage.style.display = 'block';
      } else {
        errorMessage.style.display = 'none';
      }

      return isValid;
    };

    window.togglePasswordVisibility = function (icon) {
      const input = icon.previousElementSibling;
      if (input.type === 'password') {
        input.type = 'text';
        icon.src = 'https://cdn.shopify.com/s/files/1/0780/6255/1355/files/imgpsh_fullsize_anim_27.png?v=1740467283';
        icon.alt = 'Hide Password';
      } else {
        input.type = 'password';
        icon.src = 'https://cdn.shopify.com/s/files/1/0780/6255/1355/files/pass.png?v=1740467283';
        icon.alt = 'Show Password';
      }
    };

    function getFieldInput(
      field,
      formUrl,
      submissionOption,
      thankYouTimer,
      editorValue,
      formshop,
      formTitle,
      toggleStatus,
      inputRadius,
      inputBorderColor,
      inputBgColor,
      inputStyle,
      inputWidth,
      emailsubject,
      labelColor,
      maxDescriptionHeight,
      shopNameHeading
    ) {
      const uniqueId = field.id || generateUniqueId();

      switch (field.type) {
        case 'name':
          return `<input type="text" oninput="this.value = this.value.replace(/[0-9]/g, '')"  placeholder="${
            field.placeholder || ''
          }"  ${field.readonly ? 'readonly' : ''} ${field.required ? 'required' : ''} ${field.disabled ? 'disabled' : ''}  style="width: 100%; padding: ${field.inputPadding}; border-radius: ${inputRadius}px; border-color: ${inputBorderColor}; background-color:${inputBgColor}; border-width:${inputWidth}px; border-style:${inputStyle} " aria-label="${field.label || 'Name'}" /> <div class="description" style="word-break: break-word; min-height: ${maxDescriptionHeight}px;">${field.description}</div> `;
        case 'text':
          return `<input type="text" oninput="this.value = this.value.replace(/[0-9]/g, '')"  placeholder="${
            field.placeholder || ''
          }" ${field.readonly ? 'readonly' : ''} ${field.required ? 'required' : ''} ${field.disabled ? 'disabled' : ''}  style="width: 100%;padding: ${field.inputPadding};border-radius: ${inputRadius}px; border-color: ${inputBorderColor}; background-color:${inputBgColor}; border-width:${inputWidth}px; border-style:${inputStyle} " aria-label="${field.label || 'Text Input'}" /> <div class="description" style=" word-break: break-word; min-height: ${maxDescriptionHeight}px;">${field.description}</div>`;
        case 'toggle':
          return `
            <label style="display: flex; position: relative; width: 50px; height: 24px;">
              <input 
                type="checkbox" 
                name="${field.label || 'toggle'}" 
                ${field.readonly ? 'readonly' : ''} 
                ${field.required ? 'required' : ''} 
                ${field.disabled ? 'disabled' : ''} 
                aria-label="${field.label || 'Toggle'}" 
                onchange="
                  this.nextElementSibling.style.backgroundColor = this.checked ? '#45A7F6' : '#cccccc'; 
                  this.nextElementSibling.nextElementSibling.style.transform = this.checked ? 'translateX(26px)' : 'translateX(0)';
                  togglevalue = this.checked ? '${field.onValue}' : '${field.offValue}';
          
                "
              />
              <span style="
                position: absolute;
                cursor: pointer;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: #cccccc;
                transition: 0.4s;
                border-radius: 24px;
              "></span>
              <span style="
                position: absolute;
                content: '';
                height: 18px;
                width: 18px;
                left: 3px;
                bottom: 3px;
                background-color: white;
                transition: 0.4s;
                border-radius: 50%;
                transform: translateX(0);
              "></span>
            </label>
            <div class="description" style="word-break: break-word; min-height: ${maxDescriptionHeight}px;">${field.description || ''}</div>
          `;

        case 'textarea':
          return `
              <textarea 
                oninput="this.value = this.value.replace(/[0-9]/g, '')" 
                id="${field.name || 'textarea-field'}"
                name="${field.name || 'textarea-field'}"
                placeholder="${field.placeholder || ''}"
                ${field.readonly ? 'readonly' : ''}
                ${field.required ? 'required' : ''}
                ${field.disabled ? 'disabled' : ''}
                rows="4" cols="50"
                style="
                  width:100%;
                  padding: ${field.inputPadding || '8px'};
                  border-radius: ${inputRadius}px;
                  border-color: ${inputBorderColor};
                  background-color: ${inputBgColor};
                  border-width: ${inputWidth}px;
                  border-style: ${inputStyle};
                  font-family: inherit;
                  resize: vertical; 
                "
                aria-label="${field.label || 'Textarea'}"
              ></textarea> 
              <div class="description" style="word-break: break-word; min-height: ${maxDescriptionHeight}px;">
                ${field.description}
              </div>
            `;

        case 'checkbox':
          return `
              <div class="checkbox-button" style="width:100%;padding:${field.inputPadding};
                border-radius:${inputRadius}px; border-color:${inputBorderColor}; 
                background-color:${inputBgColor}; border-width:${inputWidth}px; 
                border-style:${inputStyle}">
                ${field.options
                  .map(
                    (option, index) => `
                      <div class="form_checkbox_flex" 
                        style="display: flex; gap: 10px; align-items: center; padding: 10px;">
                        <input type="checkbox" 
                          ${field.required ? 'required' : ''} 
                          ${field.readonly ? 'readonly' : ''}  
                          ${field.disabled ? 'disabled' : ''}  
                          id="${field.name}-${index}-${uniqueId}" 
                          name="${field.name}[]" 
                          value="${option.value}" 
                          ${option.checked ? 'checked' : ''} />
                        <label for="${field.name}-${index}-${uniqueId}">${option.label}</label>
                      </div>
                    `
                  )
                  .join('')}
              </div>
              <div class="description" 
                style="word-break: break-word; min-height: ${maxDescriptionHeight}px;">
                ${field.description}
              </div>
            `;

        case 'radio':
          return `
                <div class="radio-button" style="width:100%;padding:${field.inputPadding};
                  border-radius:${inputRadius}px; border-color:${inputBorderColor}; 
                  background-color:${inputBgColor}; border-width:${inputWidth}px; 
                  border-style:${inputStyle}">
                  ${field.options
                    .map(
                      (option, index) => `
                        <div class="form_radio_flex" 
                          style="display: flex; gap: 10px; align-items: center; padding: 10px;">
                          <input type="radio" ${field.readonly ? 'readonly' : ''} 
                            ${field.required ? 'required' : ''} 
                            ${field.disabled ? 'disabled' : ''}  
                            id="${field.name}-${index}-${uniqueId}" 
                            name="${field.name}-${uniqueId}" 
                            value="${option.value}" 
                            ${option.checked ? 'checked' : ''} 
                            aria-label="${field.label || 'Radio Input'}"/>
                          <label for="${field.name}-${index}-${uniqueId}">${option.label}</label>
                        </div>
                      `
                    )
                    .join('')}
                </div>
                <div class="description" 
                  style="word-break: break-word; min-height: ${maxDescriptionHeight}px;">
                  ${field.description}
                </div>
              `;
        case 'select':
          const options = `
                  <div class="custom-select-option" data-value="" style="font-weight: bold; color: #888;">
                      Select an option
                  </div>
                  ${field.options
                    .map(
                      (option) => `<div class="custom-select-option" data-value="${option.value}">${option.label}</div>`
                    )
                    .join('')}
              `;
          return `
                <div class="custom-select-container" style="position: relative;">
                  <div class="custom-select-box" ${
                    field.readonly ? 'readonly' : ''
                  } ${field.required ? 'required' : ''} ${field.disabled ? 'disabled' : ''}  style="width: 100%; padding: ${field.inputPadding}; border-radius: ${inputRadius}px; border-color: ${inputBorderColor}; background-color :${inputBgColor}; border-width:${inputWidth}px; border-style:${inputStyle}; cursor: pointer;" onclick="toggleDropdown(event, '${field.id}')">
                    <span>${
                      field.label || 'Select Input'
                    }</span><span style="float: right"><img src="https://cdn.shopify.com/s/files/1/0682/5974/1942/files/imgpsh_fullsize_anim_52.png?v=1741756373"style = "width:15px;"></span>
                  </div>
                  <div id="dropdown-${
                    field.id
                  }" class="custom-select-dropdown" style="display: none; position: absolute; top: 100%; left: 0; right: 0; max-height: 200px; overflow-y: auto; border: 1px solid ${inputBorderColor || '#ccc'}; background-color: #fff; padding: 5px; z-index: 100;">
                    <input
                      type="text"
                      id="search-${field.id}"
                      placeholder="Search..."
                      style="width: 100%; padding: 5px; margin-bottom: 5px; border-radius: ${
                        inputRadius || '4px'
                      }px; border: 1px solid #ccc;"
                      oninput="filterOptions(event, '${field.id}')"
                    />
                    <div class="options-container" style="cursor: pointer">
                      ${options}
                    </div>
                  </div>
                </div>
              
                <div class="description" style="word-break: break-word; min-height: ${maxDescriptionHeight}px;">${field.description}</div>
              `;
        case 'divider':
          return `<div style="display: flex; justify-content: ${field.dividerAline}">
                        <hr style="border: 1px solid ${field.dividerColor}; width: ${field.dividerWidth}; margin:0;" /> 
                        <div class="description" 
                             style="word-break: break-word; min-height: ${maxDescriptionHeight}px;">
                             ${field.description}
                        </div>
                      </div>`;
        case 'description':
          return `<span style="font-size: ${field.textSize || '16px'}px; 
                  color: ${field.textColor || '#000'}; 
                  line-height:${field.textlineheight}px;
                  padding-left: ${field.textPadding || '5'}px;
                  padding-right: ${field.textPadding || '5'}px;
                  text-align: ${field.textAline || 'left'};">
                  ${field.text || 'Default description'}
                  </span>`;
        case 'heading':
          let fontSize = '';
          if (['h1', 'h2', 'h3', 'h4', 'h5', 'h6'].includes(field.level)) {
            switch (field.level) {
              case 'h1':
                fontSize = `${field.fontSize || 40}px`;
                break;
              case 'h2':
                fontSize = `${field.fontSize || 36}px`;
                break;
              case 'h3':
                fontSize = `${field.fontSize || 30}px`;
                break;
              case 'h4':
                fontSize = `${field.fontSize || 26}px`;
                break;
              case 'h5':
                fontSize = `${field.fontSize || 23}px`;
                break;
              case 'h6':
                fontSize = `${field.fontSize || 19}px`;
                break;
            }
          }
          return `<${field.level} style="font-size: ${fontSize}; 
                          line-height:${field.headingLineheight}px;
                          color: ${field.colorHeading || '#000'}; 
                          margin:0;
                          text-align: ${field.textHeading || 'left'};">
                          ${field.text || 'Default Heading'}
                          </${field.level}>`;

        case 'number':
          return `<input  ${
            field.readonly ? 'readonly' : ''
          } ${field.required ? 'required' : ''} ${field.disabled ? 'disabled' : ''}   oninput="this.value = this.value.replace(/[^0-9]/g, '')"   type="text" oninput="this.value = this.value.replace(/[^0-9]/g, '')" placeholder="${field.placeholder || ''}" style="width: 100%; padding: ${field.inputPadding};border-radius: ${inputRadius}px; border-color: ${inputBorderColor}; background-color:${inputBgColor}; border-width:${inputWidth}px; border-style:${inputStyle} "  " /> <div class="description" style="word-break: break-word; min-height: ${maxDescriptionHeight}px;">${field.description}</div>`;
        case 'file':
          let fileInputHTML = '';
          if (field.fileOptions[field.id] === 'option1') {
            fileInputHTML = `
              <input  type="file" ${field.readonly ? 'readonly' : ''} ${field.required ? 'required' : ''} ${
              field.disabled ? 'disabled' : ''
            }  placeholder="${field.placeholder || ''}" 
                style="width: 100%; padding: ${field.inputPadding}; border-radius: ${inputRadius}px; 
                border-color: ${inputBorderColor}; background-color: ${inputBgColor}; border-width: ${inputWidth}px; 
                border-style: ${inputStyle}" onchange="handleSingleInputChange(event, '${field.id}', '${
              field.label
            }','${field.ImagePreview}')" /> 
             <div id="max-file-size-${field.id}" style="color: red; display: none;">Maximum allowed size is 50MB</div>
              <div class="description" style=" word-break: break-word; min-height: ${maxDescriptionHeight}px;">${
              field.description
            }</div>
            `;
          } else if (field.fileOptions[field.id] === 'option2') {
            fileInputHTML = `
            <div class="drag-and-drop-text third" style="text-align: center; color:black;"  >
                <div class='form-builder-chaneging-wrap file' style="border-radius:10px; border: 2px dashed #8ee2b4; margin: auto; justify-content: center; background: white; padding: 20px;" 
                onclick="handleClickImages('file-input-${field.id}')"
                ondragover="handleDragOverimages(event)"
                  ondrop="handleDropimages(event, '${field.id}', '${field.label}', '${field.ImagePreview}')">  
                 <input type="file" ${field.readonly ? 'readonly' : ''} ${field.required ? 'required' : ''} ${
              field.disabled ? 'disabled' : ''
            } accept="image/*" id="file-input-${
              field.id
            }" style="opacity:0;" onchange="handleSingleInputChange(event, '${field.id}', '${field.label}','${
              field.ImagePreview
            }')" />
                  <div class='form-builder-changes-file-wraped'>
                    <img src="https://cdn.shopify.com/s/files/1/0780/6255/1355/files/singlefile.png?v=1739342645" alt="" style="display: inline;" />
                    <div class='email-files drop' style="margin-top: 10px;">
                      <p style="font-size: 15px; font-weight: 600; color:black;">Drag & Drop your files here</p>
                    </div>
                  </div>
                </div>
              </div>
              <ul id="file-names-list-${field.id}" style="margin-top: 8px; text-align: left; color: grey;"></ul>
              <div id="max-file-size-${field.id}" style="color: red; display: none;">Maximum allowed size is 50MB</div>
           <div class="description" style="word-break: break-word; min-height: ${maxDescriptionHeight}px;">${
              field.description
            }</div>
            `;
          } else if (field.fileOptions[field.id] === 'option3') {
            fileInputHTML = `
            <div class="drag-and-drop-text first" style="text-align: center; color:black;"  >
               <div class='form-builder-chaneging-wrap file' style="border-radius: 10px; border: 2px dashed #8ee2b4; margin: auto; justify-content: center; background: white; padding:${
                 field.width === '25%' ? '20px' : '20px'
               };" 
               onclick="handleClickImages('file-input-${field.id}')"
               ondragover="handleDragOverimages(event)"
                ondrop="handleDropimages(event, '${field.id}', '${field.label}', '${field.ImagePreview}')">  
                 <input type="file"${field.readonly ? 'readonly' : ''} ${field.required ? 'required' : ''} ${
              field.disabled ? 'disabled' : ''
            } accept="image/*" id="file-input-${
              field.id
            }" style="opacity:0;" onchange="handleSingleInputChange(event, '${field.id}', '${field.label}','${
              field.ImagePreview
            }')" />
             <div class="form-builder-changes-file-wraped" style="display: flex; gap: 10px; justify-content: center; align-items: center;">
              <img src="https://cdn.shopify.com/s/files/1/0780/6255/1355/files/1.png?v=1739342645" style="width: ${
                field.width === '25%' ? '50px' : 'auto'
              };" alt="" />
                 <div class="email-files drop" style="width: ${
                   field.width === '25%'
                     ? '100%'
                     : field.width === '50%'
                     ? '100%'
                     : field.width === '75%'
                     ? '38%'
                     : field.width === '100%'
                     ? '26%'
                     : field.width || '60%'
                 };">
                 <p style="font-size:${field.width === '25%' ? '11px' : '15px'};color:black; text-align: ${
              field.width === '25%' ? 'left' : ''
            };">Drop Files Here or <span style="color: #00ac4f;">browse for files.</span></p>
                </div>
                 </div>
               </div>
           </div>
              <ul id="file-names-list-${field.id}" style="margin-top: 8px; text-align: left; color: grey;"></ul>
              <div id="max-file-size-${field.id}" style="color: red; display: none;">Maximum allowed size is 50MB</div>
             <div class="description" style="word-break: break-word; min-height: ${maxDescriptionHeight}px;">${
              field.description
            }</div>
            `;
          }
          return fileInputHTML;
        case 'multi-file':
          let multifileInputHTML = '';
          if (field.multiOptions[field.id] === 'option1') {
            multifileInputHTML = `
              <input type="file"  ${field.readonly ? 'readonly' : ''} ${field.required ? 'required' : ''} ${
              field.disabled ? 'disabled' : ''
            }  placeholder="${field.placeholder || ''}" 
                style="width:100%; padding: ${field.inputPadding}; border-radius: ${inputRadius}px; 
                border-color: ${inputBorderColor}; background-color: ${inputBgColor}; border-width: ${inputWidth}px; 
                border-style: ${inputStyle}" multiple onchange="handleMultiInputChange(event, '${field.id}','${
              field.label
            }','${field.multifilePreview}')" /> 
            <div id="max-file-size-${field.id}" style="color: red; display: none;">Maximum allowed size is 25MB</div>
            <div id="max-file-add-${
              field.id
            }" style="color: red; display: none;">You can only upload a maximum of 10 files</div>
             <div class="description" style="word-break: break-word; min-height: ${maxDescriptionHeight}px;">${
              field.description
            }</div>
            `;
          } else if (field.multiOptions[field.id] === 'option2') {
            multifileInputHTML = `
             <div class="drag-and-drop-text third" style="text-align: center; color:black;"  >
        <div class="form-builder-chaneging-wrap file" style="border-radius:10px; border: 2px dashed #8ee2b4; margin: auto; justify-content: center; background: white; padding:${
          field.width === '25%' ? '20px' : '20px'
        };"
          onclick="handleClickmulti('file-input-${field.id}')"
         ondragover="handleDragOverfile(event)"
         ondrop="handleDropfile(event, '${field.id}', '${field.label}','${field.multifilePreview}')">
         <input type="file" ${field.readonly ? 'readonly' : ''} ${field.required ? 'required' : ''} ${
              field.disabled ? 'disabled' : ''
            } accept="image/*" id="file-input-${
              field.id
            }" style="opacity:0;" multiple onchange="handleMultiInputChange(event, '${field.id}','${field.label}','${
              field.multifilePreview
            }')"/>
          <div class="form-builder-changes-file-wraped">
         <img src="https://cdn.shopify.com/s/files/1/0682/5974/1942/files/11.png?v=1741747901" alt="" style="display: inline; width:65px;" />
         <div class ='email-files drop files' style="margin-top: 20px;">
           <h3 style="color: #404b52;font-weight: bold; font-size: ${
             field.width === '25%' ? '11px' : '19px'
           }; line-height: ${
              field.width === '25%' ? '16px' : '40px'
            };">Drag & drop files or <span style="color:#14b25c; text-decoration: underline;">Browse</span></h3>
          <p style="color: #676767; font-size: ${field.width === '25%' ? '11px' : '15px'}; max-width: ${
              field.width === '25%' ? '100%' : '53%'
            }; margin: auto; 
             line-height: ${field.width === '25%' ? '16px' : '23px'}; margin-bottom: 40px; font-weight: 550;">
            Supported formats: JPEG, PNG, GIF, MP4, PDF, PSD, AI, Word, PPT
          </p>
          <span style="background: #01ac50; color: white !important; padding: ${
            field.width === '25%' ? '10px 20px' : '10px 70px'
          }; 
             border-radius: 4px; border: 1px solid #01ac50;font-size: ${field.width === '25%' ? '12px' : '14px'};">
             Upload files
           </span>
          </div>
             </div>
          </div>
           </div>
            <div id="max-file-size-${field.id}" style="color: red; display: none;">Maximum allowed size is 25MB</div>
            <div id="max-file-add-${
              field.id
            }" style="color: red; display: none;">You can only upload a maximum of 10 files</div>
              <div class="description" style="word-break: break-word; min-height: ${maxDescriptionHeight}px;">${
              field.description
            }</div> 
            `;
          } else if (field.multiOptions[field.id] === 'option3') {
            multifileInputHTML = `
            <div class="drag-and-drop-text first" style="text-align: center; color:black;"  >
                <div class="form-builder-chaneging-wrap file" style="border-radius:10px; border: 2px dashed #8ee2b4; margin: auto; justify-content: center; background: white; padding:${
                  field.width === '25%' ? '20px' : '20px'
                };" 
                onclick="handleClickmulti('file-input-${field.id}')"
                 ondragover="handleDragOverfile(event)"
                 ondrop="handleDropfile(event, '${field.id}', '${field.label}','${field.multifilePreview}')">
                  <input type="file" ${field.readonly ? 'readonly' : ''} ${field.required ? 'required' : ''} ${
              field.disabled ? 'disabled' : ''
            } accept="image/*" id="file-input-${
              field.id
            }" style="opacity:0;" multiple onchange="handleMultiInputChange(event, '${field.id}','${field.label}','${
              field.multifilePreview
            }')" />
                  <div class="form-builder-changes-file-wraped">
                    <img src="https://cdn.shopify.com/s/files/1/0780/6255/1355/files/mut2.png?v=1739350278" alt="" style="display: inline;" />
                   <div class ='email-files drop files' style="margin-top: 20px; margin-bottom: 30px;">
                     <h2 style="font-weight: ${field.width === '25%' ? '600' : '600px'}; font-size: ${
              field.width === '25%' ? '14px' : '18px'
            }; color:black;"> Drag & Drop <span style="color:#09ae54;">images,</span></h2>
                     <h2 style="font-weight: ${field.width === '25%' ? '600' : '600px'}; font-size: ${
              field.width === '25%' ? '14px' : '18px'
            };"><span style="color:#09ae54;">videos,</span> <span style="color:black;"> or any </span> <span style="color:#09ae54;" >file</span></h2>
                     </div>
                    <span class="form-builder-changes-file-button" style="background: #00ac4f; border-radius: 31px;
                     padding: 5px 22px; font-size: ${
                       field.width === '25%' ? '12px' : '17px'
                     };border: 0;color: white;display: inline-block;text-align: center;">
                    Upload
                       </span>

                  </div>
                </div>
              </div>
              <div id="max-file-size-${field.id}" style="color: red; display: none;">Maximum allowed size is 25MB</div>
            <div id="max-file-add-${
              field.id
            }" style="color: red; display: none;">You can only upload a maximum of 10 files</div>
              <div class="description" style="word-break: break-word; min-height: ${maxDescriptionHeight}px;">${
              field.description
            }</div> 
            `;
          }
          return `
        
            <div style="display: flex; flex-direction: column;">
              ${multifileInputHTML}
              <ul id="file-names-list-${field.id}" style="margin-top: 8px; text-align: left; color: grey;"></ul>
              ${field.description ? `<span style="margin-top: 8px;">${field.description}</span>` : ''}
            </div>
          `;

        case 'email':
          return `<input type="email" ${
            field.readonly ? 'readonly' : ''
          } ${field.emailRequid ? 'required' : ''} ${field.disabled ? 'disabled' : ''}  placeholder="${field.placeholder || ''}" style="width: 100%; padding: ${field.inputPadding};border-radius: ${inputRadius}px; border-color: ${inputBorderColor}; background-color:${inputBgColor}; border-width:${inputWidth}px; border-style:${inputStyle} "  " />  <div class="description" style="word-break: break-word; min-height: ${maxDescriptionHeight}px;">${field.description}</div>`;
        case 'phone':
          const phoneInputHtml = `
          <input type="tel" id="phone-${uniqueId}"
       placeholder="${field.placeholder || ''}" 
       ${field.readonly ? 'readonly' : ''} 
       ${field.required ? 'required' : ''} 
      ${field.disabled ? 'disabled' : ''}  
       inputmode="tel"   pattern="^\\+?[0-9\\s\\-()]{10,17}$"
         style="
        width: 100%; 
        padding: ${field.inputPadding || '10px'}; 
        border-radius: ${inputRadius || '4px'}px; 
        border-color: ${inputBorderColor || '#ccc'}; 
        background-color: ${inputBgColor || '#fff'}; 
        border-width: ${inputWidth || '1'}px; 
        padding-left: 50px;
        height: 52px;
        border-style: ${inputStyle || 'solid'};
        "
               />
           <div class="description" style="word-break: break-word; min-height: ${maxDescriptionHeight}px;">
    ${field.description}
             </div>
        `;
          setTimeout(() => {
            const phoneInput = document.querySelector(`#phone-${uniqueId}`);
            if (phoneInput) {
              const iti = window.intlTelInput(phoneInput, {
                initialCountry: 'us',
                utilsScript: 'https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/18.1.1/js/utils.js',
              });

              iti.setCountry('us');
              $('.iti').css('width', '100%');
              let alertShown = false;

              phoneInput.addEventListener('input', () => {
                phoneInput.value = phoneInput.value.replace(/[^0-9]/g, '');

                if (phoneInput.value.length > 17) {
                  phoneInput.value = phoneInput.value.substring(0, 17);
                }
                const phoneNumber = iti.getNumber();
                console.log('Formatted phone number: ', phoneNumber);
              });
            }
          }, 100);
          return phoneInputHtml;
        case 'password':
          return `
            <div style="position: relative; ">
              <input type="password" ${
                field.readonly ? 'readonly' : ''
              } ${field.required ? 'required' : ''} ${field.disabled ? 'disabled' : ''} 
                placeholder="${field.placeholder || ''}" 
                style="width: 100%; padding: ${field.inputPadding}; padding-right: 40px;
                border-radius: ${inputRadius}px; border-color: ${inputBorderColor};
                background-color: ${inputBgColor}; border-width: ${inputWidth}px;
                border-style: ${inputStyle}" 
                data-password-status="${field.passwordStatus}" 
                data-password-character="${field.passwordCharacter || 6}"
                oninput="validatePassword(this, this.dataset.passwordCharacter)"
              />
               <img src="https://cdn.shopify.com/s/files/1/0780/6255/1355/files/pass.png?v=1740467283" 
               onclick="togglePasswordVisibility(this)" 
                style="position: absolute; right: 10px; top: 21px; cursor: pointer; user-select: none; width: 21px; height: 15px;"
              alt="Show Password"
              />
              <small style="color: red; display: none;"></small>
            </div>
            <div class="description" style="word-break: break-word; min-height: ${maxDescriptionHeight}px;">${field.description}</div>
          `;
        case 'url':
          return `<input type="url" ${
            field.readonly ? 'readonly' : ''
          } ${field.required ? 'required' : ''} ${field.disabled ? 'disabled' : ''}  placeholder="${field.placeholder || ''}" style="width:100%; padding: ${field.inputPadding};border-radius: ${inputRadius}px; border-color: ${inputBorderColor}; background-color:${inputBgColor}; border-width:${inputWidth}px; border-style:${inputStyle} "  " /> <div class="description" style="word-break: break-word; min-height: ${maxDescriptionHeight}px;">${field.description}</div> `;
        case 'location':
          return `<input type="text" ${
            field.readonly ? 'readonly' : ''
          } ${field.required ? 'required' : ''} ${field.disabled ? 'disabled' : ''}  placeholder="${field.placeholder || ''}" style="width:100%; padding: ${field.inputPadding};border-radius: ${inputRadius}px; border-color: ${inputBorderColor}; background-color:${inputBgColor}; border-width:${inputWidth}px; border-style:${inputStyle} "  " /> <div class="description" style="word-break: break-word; min-height: ${maxDescriptionHeight}px;">${field.description}</div>`;
        case 'date':
          return `<input type="date" ${
            field.readonly ? 'readonly' : ''
          } ${field.required ? 'required' : ''} ${field.disabled ? 'disabled' : ''}  placeholder="${field.placeholder || ''}" style="width:100%; padding: ${field.inputPadding};border-radius: ${inputRadius}px; border-color: ${inputBorderColor}; background-color:${inputBgColor}; border-width:${inputWidth}px; border-style:${inputStyle} "  " /><div class="description" style="word-break: break-word;min-height: ${maxDescriptionHeight}px;">${field.description}</div>`;
        case 'datetime':
          return `<input type="datetime-local" ${
            field.readonly ? 'readonly' : ''
          } ${field.required ? 'required' : ''} ${field.disabled ? 'disabled' : ''}   placeholder="${field.placeholder || ''}" style="width:100%; padding: ${field.inputPadding};border-radius: ${inputRadius}px; border-color: ${inputBorderColor}; background-color:${inputBgColor}; border-width:${inputWidth}px; border-style:${inputStyle} "  " /> <div class="description" style="word-break: break-word; min-height: ${maxDescriptionHeight}px;">${field.description}</div>`;
        case 'time':
          return `<input type="time" ${
            field.readonly ? 'readonly' : ''
          } ${field.required ? 'required' : ''} ${field.disabled ? 'disabled' : ''}  placeholder="${field.placeholder || ''}" style="width:100%; padding: ${field.inputPadding};border-radius: ${inputRadius}px; border-color: ${inputBorderColor}; background-color:${inputBgColor}; border-width:${inputWidth}px; border-style:${inputStyle} "  " /> <div class="description" style="word-break: break-word; min-height: ${maxDescriptionHeight}px;">${field.description}</div>`;
        case 'link':
          return `
            <a
              href="${field.linkUrl || '#'}"
              target="${field.linkTarget || '_blank'}"
              style="
                display: block; /* Ensures it takes full width */
                width: 100%;
                text-decoration: none;
                font-size: ${field.linkfontsize}px;
                text-align: ${field.linkaline || 'left'};
                padding: ${field.padding || '0'};
                color:black;
              "
            >
              ${(field.linktext || 'Default Link Text').replace(/<\/?p>/g, '')}
            </a>
            <div class="description" style="word-break: break-word; min-height: ${maxDescriptionHeight}px;">
              ${field.description}
            </div>
          `;

        case 'images':
          let imagesInputHTML = '';
          if (field.imageOptions[field.id] === 'option1') {
            imagesInputHTML = `
          <input type="file" ${field.readonly ? 'readonly' : ''} ${field.required ? 'required' : ''} ${
              field.disabled ? 'disabled' : ''
            }  placeholder="${field.placeholder || ''}" 
            style="width: 100%; padding: ${field.inputPadding}; border-radius: ${inputRadius}px; 
            border-color: ${inputBorderColor}; background-color: ${inputBgColor}; border-width: ${inputWidth}px; 
            border-style: ${inputStyle}" onchange="handleSingleInputChange(event, '${field.id}', '${field.label}', '${
              field.signlePreview
            }')"/> 
            <div id="max-file-size-${field.id}" style="color: red; display: none;">Maximum allowed size is 50MB</div>
          <div class="description" style="word-break: break-word; min-height: ${maxDescriptionHeight}px;">${
              field.description
            }</div>
        `;
          } else if (field.imageOptions[field.id] === 'option2') {
            imagesInputHTML = `
      
          <div class="drag-and-drop-text third" style="text-align: center; color:black;"  >
            <div class='form-builder-chaneging-wrap file' style="border-radius:10px; border: 2px dashed #8ee2b4; margin: auto; justify-content: center; background: white; padding: 20px;" 
              onclick="handleClickImages('file-input-${field.id}')"
               ondragover="handleDragOverimages(event)"
              ondrop="handleDropimages(event, '${field.id}', '${field.label}', '${field.signlePreview}')"> 
              <input type="file" ${field.readonly ? 'readonly' : ''} ${field.required ? 'required' : ''} ${
              field.disabled ? 'disabled' : ''
            } accept="image/*" id="file-input-${
              field.id
            }" style="opacity:0;" onchange="handleSingleInputChange(event, '${field.id}', '${field.label}' , '${
              field.signlePreview
            }')" />
              <div class='form-builder-changes-file-wraped'>
                <img src="https://cdn.shopify.com/s/files/1/0780/6255/1355/files/singleimage0.png?v=1739353222" alt="" style="display: inline;" />
                <div class='email-files drop' style="margin-top: 20px;">
                  <p style="font-size: 15px; color:black; font-weight: 600;">Drag & Drop your image here</p>
                </div>
              </div>
            </div>
          </div>
          <ul id="file-names-list-${field.id}" style="margin-top: 8px; text-align: left; color: grey;"></ul>
          <div id="max-file-size-${field.id}" style="color: red; display: none;">Maximum allowed size is 50MB</div>
          <div class="description" style="word-break: break-word; min-height: ${maxDescriptionHeight}px;">${
              field.description
            }</div>
        `;
          } else if (field.imageOptions[field.id] === 'option3') {
            imagesInputHTML = `
        <div class="drag-and-drop-text first" style="text-align: center; color:black;"  >
          <div class="form-builder-chaneging-wrap file" 
        style="border-radius:10px; border: 2px dashed #8ee2b4; margin: auto; justify-content: center; background: white; padding: ${
          field.width === '25%' ? '20px' : '20px'
        };" 
        onclick="handleClickImages('file-input-${field.id}')"
        ondragover="handleDragOverimages(event)"
        ondrop="handleDropimages(event, '${field.id}', '${field.label}', '${field.signlePreview}')"> 
        <input type="file" ${field.readonly ? 'readonly' : ''} ${field.required ? 'required' : ''} ${
              field.disabled ? 'disabled' : ''
            } accept="image/*" id="file-input-${
              field.id
            }" style="opacity:0;" onchange="handleSingleInputChange(event, '${field.id}', '${field.label}', '${
              field.signlePreview
            }')" />
         <div class="form-builder-changes-file-wraped" 
         style="display: flex; gap: ${
           field.width === '25%' ? '10px' : '50px'
         }; justify-content: center; align-items: center;">
            <img src="https://cdn.shopify.com/s/files/1/0780/6255/1355/files/singleimage1.png?v=1739353222" 
            alt="Upload" 
         style="width: ${field.width === '25%' ? '50px' : 'auto'};" />
         <div class="email-files drop" 
         style="width: ${
           field.width === '25%'
             ? '100%'
             : field.width === '50%'
             ? '100%'
             : field.width === '75%'
             ? '38%'
             : field.width === '100%'
             ? '26%'
             : field.width || '60%'
         };">
        
          <h2 style="color:black; text-align: ${field.width === '25%' ? 'left' : 'center'}; 
                   font-size: ${field.width === '25%' ? '11px' : '18px'}; 
                   font-weight: ${field.width === '25%' ? '500' : '600'};">
          Drop image Here or <span style="color: #00ac4f;">browse for image.</span>
          </h2>

        </div>
        </div>
        </div>
         </div>
       <ul id="file-names-list-${field.id}" style="margin-top: 8px; text-align: left; color: grey;"></ul>
         <div id="max-file-size-${field.id}" style="color: red; display: none;">Maximum allowed size is 50MB</div>
          <div class="description" style="word-break: break-word; min-height: ${maxDescriptionHeight}px;">${
              field.description
            }</div>
        `;
          }
          return imagesInputHTML;

        case 'multi-image':
          let multiimageInputHTML = '';
          if (field.multiimagesOptions[field.id] === 'option1') {
            multiimageInputHTML = `
              <input type="file" ${field.readonly ? 'readonly' : ''} ${field.required ? 'required' : ''} ${
              field.disabled ? 'disabled' : ''
            }  placeholder="${field.placeholder || ''}" 
                style="width: 100%; padding: ${field.inputPadding}; border-radius: ${inputRadius}px; 
                border-color: ${inputBorderColor}; background-color: ${inputBgColor}; border-width: ${inputWidth}px; 
                border-style: ${inputStyle}" multiple onchange="handleFileInputChange(event, '${field.id}', '${
              field.label
            }','${field.multiIamgePreview}')" /> 
            <div id="max-file-size-${field.id}" style="color: red; display: none;">Maximum allowed size is 25MB</div>
            <div id="max-file-add-${
              field.id
            }" style="color: red; display: none;">You can only upload a maximum of 10 files</div>
              <div class="description" style="word-break: break-word; min-height: ${maxDescriptionHeight}px;">${
              field.description
            }</div>
            `;
          } else if (field.multiimagesOptions[field.id] === 'option2') {
            multiimageInputHTML = `
      
                <div class="drag-and-drop-text third" style="text-align: center; color:black;"  >
             <div class="drag-and-drop-text first multi-imagess" style="border-radius:10px; border: 2px dashed #8ee2b4; margin: auto; justify-content: center; background: white; padding: ${
               field.width === '25%' ? '20px' : '20px'
             };"
         onclick="handleClickmulti('file-input-${field.id}')"
          ondragover="handleDragOver(event)"
          ondrop="handleDrop(event, '${field.id}','${field.label}','${field.multiIamgePreview}')">
            <input type="file"${field.readonly ? 'readonly' : ''} ${field.required ? 'required' : ''} ${
              field.disabled ? 'disabled' : ''
            } accept="image/*" id="file-input-${
              field.id
            }" style="opacity:0;" multiple onchange="handleFileInputChange(event, '${field.id}', '${field.label}','${
              field.multiIamgePreview
            }')"/>
         <div class="form-builder-changes-file-wraped">
        <img src="https://cdn.shopify.com/s/files/1/0780/6255/1355/files/multiimg.png?v=1739355803" alt="" style="width: ${
          field.width === '25%' ? '50px' : 'auto'
        }; margin: ${field.width === '25%' ? 'auto' : 'auto'};" />
         <div class ='email-files drop' style="margin-top: 20px;">
          <h3 style="color: #404b52;font-weight: 500; font-size: ${
            field.width === '25%' ? '16px' : '19px'
          }; margin-bottom: 30px; line-height: ${field.width === '25%' ? '16px' : '40px'};">
          Drag & Drop <span style="color : #00ac4f;">images,</span>
        </h3>
        <span class="form-builder-changes-file-button" style="background: #00ac4f; border-radius: 31px; padding: 5px 22px; font-size: ${
          field.width === '25%' ? '16px' : '15px'
        }; border: 0;color: white;display: inline-block;text-align: center;">
          Upload
        </span>
         </div>
       </div>
          </div>
         </div>
              <div id="max-file-size-${field.id}" style="color: red; display: none;">Maximum allowed size is 25MB</div>
            <div id="max-file-add-${
              field.id
            }" style="color: red; display: none;">You can only upload a maximum of 10 files</div>
              <div class="description" style="word-break: break-word; min-height: ${maxDescriptionHeight}px;">${
              field.description
            }</div>
            `;
          } else if (field.multiimagesOptions[field.id] === 'option3') {
            multiimageInputHTML = `
             <div class="drag-and-drop-text first multi-imagess" style="text-align: center; color:black;"  >
                <div class="form-builder-chaneging-wrap file " style="border-radius:10px; border: 2px dashed #8ee2b4; margin: auto; justify-content: center; background: white; padding: ${
                  field.width === '25%' ? '20px' : '20px'
                };"
                 onclick="handleClickmulti('file-input-${field.id}')"
                 ondragover="handleDragOver(event)"
                 ondrop="handleDrop(event, '${field.id}','${field.label}','${field.multiIamgePreview}')">
                  <input type="file" ${field.readonly ? 'readonly' : ''} ${field.required ? 'required' : ''} ${
              field.disabled ? 'disabled' : ''
            } accept="image/*" id="file-input-${
              field.id
            }" style="opacity:0;" multiple onchange="handleFileInputChange(event, '${field.id}','${field.label}','${
              field.multiIamgePreview
            }')" />
                  <div class="form-builder-changes-file-wraped">
                    <img src="https://cdn.shopify.com/s/files/1/0682/5974/1942/files/dddddddddddddddddd.png?v=1741854389" alt="" style="display: inline; width:65px;" />
                   <div class ='email-files drop' style="margin-top: 20px; margin-bottom: ${
                     field.width === '25%' ? '0' : '20px'
                   };">
                     <h2 style="color:black; font-weight: 600; font-size: ${
                       field.width === '25%' ? '16px' : '18px'
                     }; margin:0;">Drop your images here </h2>
                       <h2 style=" margin:0; font-weight: 500; font-size: 14px;"><span style="color:#00ac4f;">Browse file </span> <span style="color:black;"> from your computer </span></h2>
                     </div>
                  
                  </div>
                </div>
              </div>
             <div id="max-file-size-${field.id}" style="color: red; display: none;">Maximum allowed size is 25MB</div>
            <div id="max-file-add-${
              field.id
            }" style="color: red; display: none;">You can only upload a maximum of 10 files</div>
              <div class="description" style="word-break: break-word; min-height: ${maxDescriptionHeight}px;">${
              field.description
            }</div>
            `;
          }
          return `
            <div style="display: flex; flex-direction: column;">
              ${multiimageInputHTML}
              <ul id="image-names-list-${field.id}" style="margin-top: 8px; text-align: left; color: grey;"></ul>
              ${field.description ? `<span style="margin-top: 8px;">${field.description}</span>` : ''}
            </div>
          `;
        case 'slider':
          return `
              <div style="position: relative; display: flex; flex-direction: column; align-items: center;padding:0 0 25px;">
                  
                  <input 
                      type="range" 
                      id="${field.name || 'slider-field'}"
                      name="${field.name || 'slider-field'}"
                      ${field.required ? 'required' : ''} 
                      ${field.disabled ? 'disabled' : ''} 
                      min="${field.min || 0}" 
                      max="${field.max || 100}" 
                      step="${field.step || 1}" 
                      value="${field.value || field.min || 0}" 
                      style="width: 100%;" 
                      oninput="document.getElementById('${field.name || 'slider-field'}-value').innerText = this.value"
                  />
                    <span class="slider-value" id="${
                      field.name || 'slider-field'
                    }-value">${field.value || field.min || 0}</span>
                  <div class="description" style="word-break: break-word; min-height: ${maxDescriptionHeight}px;">
                      ${field.description || ''}
                  </div>
              </div>`;

        case 'button':
          return `
              <div style= "text-align:${field.buttonaline || 'left'}; width:100%;">
                <button
                  type="submit"
                  style="background-color: ${
                    field.backgroundColor || '#007bff'
                  }; min-height: ${field.buttonHeight || '40px'}; 
                    min-width: ${field.btnwidth}px;
                    font-size: ${field.buttontext}px;
                    padding: ${field.padding}px;
                    border-width: ${field.buttonBorderWidth}px;
                    border-style: ${field.buttonBorderStyle || 'solid'};
                    border-color: ${field.buttonBorderColor || '#000'};
                    border-radius: ${field.btnradious}px;
                    cursor:pointer;
                    color:${field.btncolor}"
                  ">
                  ${field.label || 'Submit'}
                </button>
              </div>
            `;

        default:
          return '';
      }
    }

    function generateUniqueId() {
      return Math.random().toString(36).substr(2, 9);
    }

    const currentTimestamp = new Date().toISOString();
    window.submitFormData = function (
      event,
      blockId,
      formID,
      formTitle,
      formshop,
      shopNameHeading,
      toggleStatus,
      editorValue,
      submissionOption,
      thankYouTimer,
      formUrl,
      emailsubject,
      shopNameEmail,
      onwerShopData,
      nofieldValue,
      button
    ) {
      event.preventDefault();

      const container = $('#formData-' + blockId);
      const formData = {
        id: formID,
        shop: formshop || 'defaultShopName',
        title: formTitle || 'defaultTitle',
        fields: [],
        send: currentTimestamp,
        url: formUrl,
        editorValue: editorValue,
        thankYouTimer: thankYouTimer,
        shopowner: shopNameHeading,
        shopEmail: shopNameEmail,
        onwerShop: onwerShopData,
      };

      if (toggleStatus === 'Enabled') {
        formData.currentUrl = window.location.href;
      } else if (toggleStatus === 'Disabled') {
      }

      const emailField = $('#formData-' + blockId + ' input[type="email"]');
      const emailValue = emailField.length ? emailField.val() : '';
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

      if (emailField.length === 0 || emailValue === '') {
        formData.email = 'no email';
      } else if (!emailRegex.test(emailValue)) {
        return false;
      } else {
        formData.email = emailValue;
      }

      let isValid = true;

      let uploadedFileNames = new Set();
      let uniqueImageFileNames = new Set();
      let uniqueImageImagesNames = new Set();
      $('#formData-' + blockId + ' .input-field').each(function () {
        const fieldName = $(this).children('label').first().text().trim();
        const input = $(this).find('input, select, textarea');
        const dropdown = $(this).find('.custom-select-box span:first-child');

        $('#formData-' + blockId + ' .input-field').each(function () {
          const dropdown = $(this).find('.custom-select-box');
          let errorMessage = $(this).find('.select-error-message');
      
          if (dropdown.length > 0 && dropdown.attr('required') !== undefined) {
              const selectedValue = dropdown.find('span:first-child').text().trim();
      
              if (selectedValue === 'Select an option' || selectedValue === 'Select' || selectedValue === '') {
                  isValid = false;
      
                  if (errorMessage.length === 0) {
                      dropdown.after(`
                        <div class="select-error-message" style="display: none;">
                          <img src="https://cdn.shopify.com/s/files/1/0682/5974/1942/files/bannerwdddwdwwd.png?v=1742553133">
                          Please select an item in this list
                          <img class="error-icon" src="https://cdn.shopify.com/s/files/1/0682/5974/1942/files/dwdwdwdwd.png?v=1742554233" alt="Error Icon">
                        </div>
                      `);
                      $(this).find('.select-error-message').fadeIn(300); 
                  }
              } else {
                  isValid = true;
                  $(this).find('.select-error-message').fadeOut(200, function () {
                      $(this).remove();
                  });
              }
          }
      });
      
      $(document).on('click', function (event) {
          if (!$(event.target).closest('.custom-select-box').length) {
              $('.select-error-message').fadeOut(200, function () {
                  $(this).remove();
              });
          }
      });
      

        $('.custom-select-option').on('click', function () {
          const dropdown = $(this).closest('.custom-select-container').find('.custom-select-box');
          $(this).closest('.custom-select-container').find('.select-error-message').remove();
        });

        const fieldId = input.attr('id') || generateUniqueId();

        if (input.length > 0 && input.attr('type') === 'password') {
          const passwordValue = input.val().trim();

          if (passwordValue.length === 0) {
            return true;
          }
          const minLength = input[0].dataset.passwordStatus;

          let parsedMinLength = parseInt(minLength, 10);
          if (isNaN(parsedMinLength)) {
            parsedMinLength = parseInt(input.attr('data-password-status'), 10) || 6;
          }

          const isPasswordValid = validatePassword(input[0], parsedMinLength);

          if (!isPasswordValid) {
            isValid = false;

            const errorMessageElement = document.getElementById('password-error');
            if (errorMessageElement) {
              errorMessageElement.textContent = `Password must be at least ${parsedMinLength} characters long.`;
              errorMessageElement.style.display = 'block';
            }

            return false;
          }
        }

        window.passwordAlertShown = false;

        let fieldValue;
        let imagesFieldExists = false;
        let allFileNames = [];
        let multiFileNames = [];

        let uniqueFileNames = [];

        if (input.attr('type') === 'checkbox') {
          fieldValue = input.prop('checked') ? 'checked' : 'unchecked';
        }
        if (dropdown.length > 0) {
          fieldValue = dropdown.text().trim();
        } else if (input.is(':radio')) {
          fieldValue = $('input[name="' + input.attr('name') + '"]:checked')
            .siblings('label')
            .text()
            .trim();
        } else if (input.attr('type') === 'checkbox' && input.length === 1) {
          fieldValue = input.prop('checked') ? 'on' : 'off';
        } else if (input.is(':checkbox')) {
          fieldValue = [];
          $(this)
            .find('input[type="checkbox"]:checked')
            .each(function () {
              let checkboxLabel = $(this).siblings('label').text().trim();
              fieldValue.push(checkboxLabel);
            });

          fieldValue = fieldValue.join(', ');
        } else if (input.attr('type') === 'file') {
          fieldValue = [];

          if (uploadeImages && typeof uploadeImages === 'object') {
            Object.keys(uploadeImages).forEach((key) => {
              uploadeImages[key].forEach((file) => {
                if (file.label === file.label) {
                  const isImageAlreadyAdded = formData.fields.some(
                    (field) => field.name === file.label && field.value === file.name
                  );

                  if (!uploadedFileNames.has(file.name) && !isImageAlreadyAdded) {
                    uploadedFileNames.add(file.name);
                    formData.fields.push({
                      id: generateUniqueId(),
                      name: file.label,
                      value: file.name,
                      send: currentTimestamp,
                    });
                  }
                }
                if (file.label === file.label) {
                  const isFileAlreadyAdded = formData.fields.some(
                    (field) => field.name === file.label && field.value === file.name
                  );

                  if (!uploadedFileNames.has(file.name) && !isFileAlreadyAdded) {
                    uploadedFileNames.add(file.name);
                    formData.fields.push({
                      id: generateUniqueId(),
                      name: file.label,
                      value: file.name,
                      send: currentTimestamp,
                    });
                  }
                }
              });
            });
          }
          uploadeImages = [];

          if (uploadedFiles && typeof uploadedFiles === 'object') {
            Object.keys(uploadedFiles).forEach((key) => {
              uploadedFiles[key].forEach((file) => {
                if (!uploadedFileNames.has(file.name)) {
                  if (!uniqueImageFileNames.has(file.name)) {
                    uniqueImageFileNames.add(file.name);
                    allFileNames.push(file.name);
                  }
                } else {
                  if (!uniqueImageFileNames.has(file.name)) {
                    uniqueImageFileNames.add(file.name);
                    allFileNames.push(file.name);
                  }
                }
              });
            });

            if (allFileNames.length > 0) {
              formData.fields.push({
                id: generateUniqueId(),
                name: uploadedFiles[Object.keys(uploadedFiles)[0]][0].Label,
                value: allFileNames.join(', '),
                send: currentTimestamp,
              });
            }
          }
          uploadedFiles = [];

          if (uploadedmulti && typeof uploadedmulti === 'object') {
            Object.keys(uploadedmulti).forEach((key) => {
              uploadedmulti[key].forEach((file) => {
                if (file && file.name) {
                  if (!uploadedFileNames.has(file.name)) {
                    if (!uniqueImageImagesNames.has(file.name)) {
                      uniqueImageImagesNames.add(file.name);
                      multiFileNames.push(file.name);
                    }
                  } else {
                    if (!uniqueImageImagesNames.has(file.name)) {
                      uniqueImageImagesNames.add(file.name);
                      multiFileNames.push(file.name);
                    }
                  }
                }
              });

              if (multiFileNames.length > 0) {
                formData.fields.push({
                  id: generateUniqueId(),
                  name: uploadedmulti[key]?.[0]?.Label || 'Multi-file',
                  value: multiFileNames.join(', '),
                  send: currentTimestamp,
                });
              }
            });
          }
          uploadedmulti = [];
          fieldValue = fieldValue.join(', ');
          $(this).find('input[type="file"]').replaceWith($(this).find('input[type="file"]').clone(true));
        } else {
          fieldValue = input.val();
        }

        if (fieldValue !== undefined && fieldValue.trim() !== '') {
          formData.fields.push({
            id: fieldId,
            name: fieldName,
            value: fieldValue,
            send: currentTimestamp,
          });
        }
      });

      if (!isValid) return;

      if (formData.fields.length === 0) {
        console.log('Value of noFieldValue:', nofieldValue);

        $('#formData-' + blockId)
          .find('.no-field-message')
          .remove();

        const messageElement = $(
          `<p class="no-field-message" style="color: red; font-size: 16px; margin: 0; 
             ">${nofieldValue || 'Your form is empty. Please fill in the details before submitting.'}</p>`
        );

        $('#formData-' + blockId).append(messageElement);

        setTimeout(() => {
          messageElement.fadeOut(300, function () {
            $(this).remove();
          });
        }, 3000);

        return false;
      }

      $.ajax({
        url: 'https://apps.syncform.app/api/forms',
        method: 'POST',
        contentType: 'application/json',
        data: JSON.stringify(formData),
        success: function (response) {
          if (formUrl && formUrl.trim() !== '' && formUrl !== 'undefined') {
            window.open(formUrl, '_blank');
          } else {
          }

          $(this).find('ul').empty();
          const toggleInput = $('#formData-' + blockId + ' input[type="checkbox"]');
          toggleInput.prop('checked', false);
          toggleInput.next().css('backgroundColor', '#cccccc');
          toggleInput.next().next().css('transform', 'translateX(0)');

          $('#formData-' + blockId + ' .input-field input[type="file"]').val('');
          $('#formData-' + blockId + ' .input-field ul').empty();
          $('#formData-' + blockId + ' .input-field input[type="radio"]').prop('checked', false);
          $('#formData-' + blockId + ' .input-field input[type="checkbox"]').prop('checked', false);

          $('#formData-' + blockId + ' .custom-select-box span:first-child').text('Select an option');

          if (formData.id) {
            $.ajax({
              url: 'https://apps.syncform.app/get/data',
              method: 'GET',
              success: function (data) {
                console.log('Fetched data:', data);

                const matchingForm = data.data.find((form) => form.form_ids.includes(formData.id));

                if (matchingForm) {
                  console.log('Matched form data:', matchingForm);

                  $.ajax({
                    url: 'https://apps.syncform.app/api/template',
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({
                      TemplateAll: matchingForm,
                      email: formData.email,
                      subject: emailsubject,
                      formFields: formData.fields,
                      title: formTitle || 'defaultTitle',
                      shop: formshop || 'defaultShopName',
                      shopowner: shopNameHeading || 'defaultShopName',
                      createdAt: currentTimestamp,
                    }),
                    success: function (templateResponse) {},
                    error: function (jqXHR, textStatus, errorThrown) {},
                  });
                } else {
                }
              },
              error: function (jqXHR, textStatus, errorThrown) {
                console.error('Error fetching data:', {
                  textStatus: textStatus,
                  errorThrown: errorThrown,
                  responseText: jqXHR.responseText,
                });
              },
            });
          } else {
          }

          const successMessage = '<p id="success-message">Form submitted successfully!</p>';
          const successElement = $(successMessage);

          setTimeout(function () {
            $('#success-message').remove();
          }, 2000);

          if (editorValue) {
            const editorValueDisplay = `
            <div style="color: green; font-size: 16px; display: flex; justify-content: center; align-items: center; text-align: center; position: absolute; left: 50%; transform: translate(-50%, -50%);">
            ${editorValue}
            </div>
            `;
            const messageElement = $(editorValueDisplay);
            $('#formData-' + blockId).append(messageElement);

            successElement.hide();
            $('#formData-' + blockId).append(successElement);
            const timerDuration = parseInt(thankYouTimer) * 1000 || 3000;

            setTimeout(function () {
              messageElement.remove();
            }, timerDuration);
          } else {
            $('#formData-' + blockId).append(successElement);

            setTimeout(function () {
              successElement.remove();
            }, 3000);
          }

          if (submissionOption === 'Hide form and show thank you message') {
            $('#formData-' + blockId).empty();
            if (editorValue) {
              const editorValueDisplay = `
              <div style="color: green; font-size: 16px; display: flex; justify-content: center; align-items: center; text-align: center; position: absolute; left: 50%; transform: translate(-50%, -50%);">
              ${editorValue}
              </div>
              `;

              $('#formData-' + blockId).append(editorValueDisplay);
            }
            const container = $('#formData-' + blockId);
            container.css({
              backgroundSize: 'cover',
              backgroundColor: formData.styles.backgroundColor || '',
              backgroundImage: formData.styles.backgroundImage ? `url(${formData.styles.backgroundImage})` : 'none',
              backgroundRepeat: formData.styles.backgroundRepeat || 'no-repeat',
              boxShadow: formData.styles.boxShadow || '',
              width: formData.styles.width || '100%',
              padding: formData.styles.padding || '20px',
              borderColor: formData.styles.borderColor || '',
              borderWidth: formData.styles.borderWidth || '',
              borderStyle: formData.styles.borderStyle || '',
              opacity: formData.styles.opacityForm || '',
              borderRadius: formData.styles.borderRadius ? `${formData.styles.borderRadius}px` : '',
              margin: 'auto',
            });
          } else if (thankYouTimer) {
            const timerDuration = parseInt(thankYouTimer) * 1000;
            setTimeout(() => {
              $('#formData-' + blockId + ' p').fadeOut();
            }, timerDuration);
          }

          $(
            '#formData-' + blockId + ' input, #formData-' + blockId + ' textarea, #formData-' + blockId + ' select'
          ).val('');
        },
        error: function (jqXHR, textStatus, errorThrown) {
          console.error('Error submitting form:', {
            textStatus: textStatus,
            errorThrown: errorThrown,
            responseText: jqXHR.responseText,
          });
          const errorMessage = '<p>Error submitting form. Please try again.</p>';
          const errorContainer = $('#formData-' + blockId);
          errorContainer.append(errorMessage);

          setTimeout(function () {
            errorContainer.find('p').fadeOut('slow', function () {
              $(this).remove();
            });
          }, 2000);
        },
      });
    };
  });
</script>

{% schema %}
{
  "name": "Form Submission",
  "target": "section",
  "settings": [{ "type": "text", "id": "formId", "label": "Form ID" }]
}
{% endschema %}
